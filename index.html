<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roboaventureros: Primer Grado</title>
    <style>
        /* Estilos Generales y Tipograf√≠a */
        body {
            font-family: 'Comic Sans MS', 'Nunito', sans-serif;
            background-color: #f0f9ff;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        /* Contenedores de Vistas */
        .view {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Encabezado */
        header h1 {
            font-size: 3.5rem;
            color: #1e40af;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        header p {
            font-size: 1.2rem;
            color: #3b82f6;
        }
        .main-robot-image {
            max-width: 300px;
            margin: 20px auto;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .creator-credit {
            margin-top: 40px;
            font-size: 1rem;
            color: #6b7280;
        }

        /* Botones Principales y Tarjetas */
        .main-buttons {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .card {
            background: white;
            border-radius: 25px;
            padding: 30px;
            width: 300px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border: 5px solid;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-15px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        .card-study { border-color: #60a5fa; }
        .card-eval { border-color: #f59e0b; }
        .card h2 {
            font-size: 2rem;
            margin-top: 10px;
        }
        .card-study h2 { color: #2563eb; }
        .card-eval h2 { color: #d97706; }
        .card svg {
            width: 100px;
            height: 100px;
        }
        
        /* Botones Generales */
        .btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            color: white;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
            margin: 5px;
        }
        .btn:hover {
            transform: scale(1.05);
        }
        .btn-blue { background-color: #3b82f6; }
        .btn-orange { background-color: #f59e0b; }
        .btn-green { background-color: #22c55e; }
        .btn-purple { background-color: #8b5cf6; }
        .btn-red { background-color: #ef4444; }
        .btn-back { margin-bottom: 30px; }

        /* Zona de Estudio */
        .weeks-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .week-card {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .week-card h2 {
            font-size: 2rem;
            color: #1d4ed8;
            border-bottom: 3px solid #93c5fd;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .lessons-grid {
             display: flex;
             flex-wrap: wrap;
             justify-content: center;
             gap: 15px;
        }
        .lesson-btn {
            background-color: #eff6ff;
            color: #3b82f6;
            border: 2px solid #bfdbfe;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .lesson-btn span { font-size: 1.5rem; }

        /* Zona Evaluativa - Formulario */
        .form-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            margin: 0 auto;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .form-container input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ccc;
            border-radius: 10px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        /* Zona Evaluativa - Quiz */
        .quiz-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 700px;
            margin: 0 auto;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        #question-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        #question-text {
            font-size: 1.8rem;
            margin-bottom: 0;
        }
        .btn-audio {
            background: #a5b4fc;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
            flex-shrink: 0;
        }
        .btn-audio:hover {
            background: #818cf8;
        }
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .option {
            background-color: #e0f2fe;
            border: 3px solid #7dd3fc;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 1.1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-height: 150px;
        }
        .option svg {
            height: 80px;
            width: 80px;
        }
        .option:hover {
            background-color: #bae6fd;
        }
        .option.selected {
            background-color: #60a5fa;
            color: white;
            border-color: #2563eb;
        }

        /* Zona de Resultados */
        .results-container {
            background: #dcfce7;
            border: 5px solid #22c55e;
            padding: 50px;
            border-radius: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .results-container h2 {
            font-size: 2.5rem;
            color: #166534;
        }
        .results-container p {
            font-size: 1.5rem;
        }
        #final-score {
            font-size: 4rem;
            font-weight: bold;
            color: #15803d;
        }
        
        /* Modal para Lecciones */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .activity-separator {
            border: 0;
            height: 2px;
            background: #ddd;
            margin: 30px 0;
        }
        .activity-container h4 {
            font-size: 1.5rem;
            color: #8b5cf6;
        }
        
        /* Estilos para Actividades Interactivas */
        .sort-activity {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .sort-items, .drop-zones {
            width: 100%;
            max-width: 300px;
        }
        .drop-zone {
            background-color: #f3e8ff;
            border: 3px dashed #a78bfa;
            border-radius: 10px;
            padding: 10px;
            min-height: 200px;
            margin-top: 10px;
        }
        .draggable-item {
            background-color: #e0e7ff;
            border: 2px solid #a5b4fc;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: grab;
        }
        #feedback-message {
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .drawing-canvas {
            border: 2px solid #ccc;
            border-radius: 10px;
            cursor: crosshair;
            touch-action: none;
        }
        .canvas-controls {
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <!-- Vista Principal -->
    <main id="main-view" class="view active">
        <header>
            <h1>Roboaventureros</h1>
            <img src="https://ik.imagekit.io/storybird/images/bc5195ba-b83b-4335-8554-218f3c7f5459/4_296067040.webp?tr=q-80" alt="Robot Aventurero" class="main-robot-image">
            <p>¬°Hola, Roboaventurero! Elige tu camino de aprendizaje.</p>
        </header>
        <div class="main-buttons">
            <div id="go-to-study" class="card card-study">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#60a5fa"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8a8 8 0 0 1-8 8z"/><path d="M12 7a1 1 0 0 0-1 1v4a1 1 0 0 0 .29.71l2 2a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42L13 11.59V8a1 1 0 0 0-1-1z"/></svg>
                <h2>Zona de Estudio</h2>
            </div>
            <div id="go-to-eval" class="card card-eval">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f59e0b"><path d="m20.41 4.59-1-1a2 2 0 0 0-2.82 0L5.71 14.47a1 1 0 0 0 0 1.41l1 1A2 2 0 0 0 9.53 17L20.41 6a2 2 0 0 0 0-2.82zM8.12 15.88L6.71 14.47l9.9-9.9 1.41 1.41z"/><path d="M4 20a1 1 0 0 0 1-1v-4a1 1 0 0 0-2 0v4a1 1 0 0 0 1 1z"/></svg>
                <h2>Zona Evaluativa</h2>
            </div>
        </div>
        <footer class="creator-credit">
            <p>Una aplicaci√≥n creada por: Maria Fernanda Rojas</p>
        </footer>
    </main>

    <!-- Zona de Estudio -->
    <section id="study-view" class="view">
        <button class="btn btn-blue btn-back" onclick="showView('main-view')">Volver</button>
        <h1>üìö Zona de Estudio</h1>
        <div id="weeks-container" class="weeks-container">
            <!-- El contenido se generar√° din√°micamente -->
        </div>
    </section>

    <!-- Zona Evaluativa - Registro -->
    <section id="eval-view" class="view">
        <button class="btn btn-orange btn-back" onclick="showView('main-view')">Volver</button>
        <h1>‚úèÔ∏è Zona Evaluativa</h1>
        <div class="form-container">
            <h2>¬°Prep√°rate para la evaluaci√≥n!</h2>
            <p>Escribe tu nombre y tu curso para empezar.</p>
            <input type="text" id="student-name" placeholder="Nombre completo del estudiante">
            <input type="text" id="student-course" placeholder="Curso (Ej: Primero A)">
            <button id="start-eval-btn" class="btn btn-orange">Comenzar Evaluaci√≥n</button>
        </div>
    </section>

    <!-- Zona Evaluativa - Quiz -->
    <section id="quiz-view" class="view">
         <div class="quiz-container">
            <div id="question-header">
                <h2 id="question-text"></h2>
                <button id="play-question-audio" class="btn-audio" title="Escuchar pregunta">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                </button>
            </div>
            <div id="options-container" class="options-grid"></div>
            <p id="feedback" style="display:none; margin-top: 20px; font-weight: bold;"></p>
            <button id="next-question-btn" class="btn btn-green" style="margin-top: 30px;">Siguiente</button>
        </div>
    </section>
    
    <!-- Zona Evaluativa - Resultados -->
    <section id="results-view" class="view">
        <div class="results-container">
            <h2>¬°Terminaste!</h2>
            <p>Este es tu resultado final:</p>
            <p id="final-score"></p>
            <p id="results-message"></p>
            <button class="btn btn-green" onclick="showView('main-view')">Volver al Inicio</button>
        </div>
    </section>

    <!-- Modal para Lecciones -->
    <div id="lesson-modal" class="modal">
        <div class="modal-content">
            <h2 id="lesson-title"></h2>
            <div id="lesson-content"></div>
            <hr class="activity-separator">
            <div id="activity-container" class="activity-container"></div>
            <button class="btn btn-blue" style="margin-top: 20px;" onclick="document.getElementById('lesson-modal').style.display='none'">Cerrar</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- NAVEGACI√ìN ENTRE VISTAS ---
            const views = document.querySelectorAll('.view');
            window.showView = function(viewId) { // Hacer global
                window.speechSynthesis.cancel(); // Detener audio al cambiar de vista
                views.forEach(view => view.classList.remove('active'));
                document.getElementById(viewId).classList.add('active');
            }

            document.getElementById('go-to-study').addEventListener('click', () => showView('study-view'));
            document.getElementById('go-to-eval').addEventListener('click', () => showView('eval-view'));
            document.getElementById('lesson-modal').addEventListener('click', (e) => {
                if(e.target.id === 'lesson-modal') {
                    e.target.style.display='none';
                }
            });
            document.querySelector('.modal-content').addEventListener('click', e => e.stopPropagation());

            // --- ZONA DE ESTUDIO: CONTENIDO POR SEMANAS ---
            const studyWeeks = [
                { week: 1, title: "Semana 1: El Mundo de la Tecnolog√≠a", lessons: [
                    { id: 'que_es_tecnologia', title: '¬øQu√© es la Tecnolog√≠a?', icon: 'üìñ', content: `<h3>¬°Hola, Roboaventurero!</h3><p>La tecnolog√≠a son todas las herramientas e inventos que las personas creamos para que nuestra vida sea m√°s f√°cil, mejor o m√°s divertida. ¬°Est√° en todos lados!</p><p><strong>Ejemplo:</strong> Un l√°piz es tecnolog√≠a para escribir, ¬°y una nave espacial es tecnolog√≠a para viajar a la luna!</p>`},
                    { id: 'artefactos_naturales_tecnologicos', title: 'Natural vs. Tecnol√≥gico', icon: 'üîé', content: `<h3>¬øTodo es tecnolog√≠a?</h3><p>¬°No! Hay cosas que vienen de la naturaleza y otras que inventamos nosotros.</p><p><strong>Natural:</strong> Un √°rbol, una roca, un r√≠o.</p><p><strong>Tecnol√≥gico:</strong> Una silla (hecha de madera de √°rbol), un carro.</p>`, activity: { type: 'sort', data: { title: "Clasifica los objetos", items: [{name: 'Manzana', type: 'natural'}, {name: 'Celular', type: 'tecnologico'}, {name: 'R√≠o', type: 'natural'}, {name: 'Zapatos', type: 'tecnologico'}], zones: ['Natural', 'Tecnol√≥gico']}}}
                ]},
                { week: 2, title: "Semana 2: Clasificando Artefactos", lessons: [
                    { id: 'clasificar_uso', title: 'Clasificar por su Uso', icon: 'üîé', content: `<p>Podemos agrupar los artefactos seg√∫n para qu√© los usamos. Por ejemplo, para comunicarnos, para transportarnos o para jugar.</p>`, activity: {type: 'sort', data: { title: "Clasifica por uso", items: [{name: 'Tel√©fono', type: 'comunicaci√≥n'}, {name: 'Carro', type: 'transporte'}, {name: 'Videojuego', type: 'jugar'}, {name: 'Carta', type: 'comunicaci√≥n'}], zones: ['Comunicaci√≥n', 'Transporte', 'Jugar']}}}
                ]},
                { week: 3, title: "Semana 3: Materiales y Usos", lessons: [
                    { id: 'de_que_estan_hechos', title: '¬øDe qu√© est√°n hechos?', icon: 'üìñ', content: `<p>Los artefactos se fabrican con diferentes materiales como madera, pl√°stico o metal. Cada material sirve para algo diferente.</p><p><strong>Madera:</strong> Sillas, mesas. <strong>Pl√°stico:</strong> Botellas, juguetes. <strong>Metal:</strong> Carros, llaves.</p>`}
                ]},
                { week: 4, title: "Semana 4: ¬°A Dar Instrucciones!", lessons: [
                    { id: 'que_es_secuencia', title: '¬øQu√© es una Secuencia?', icon: 'üìñ', content: `<h3>¬°Los pasos importan!</h3><p>Una secuencia es un grupo de pasos que se hacen en un orden especial. Si cambias el orden, ¬°el resultado puede ser muy diferente!</p>`, activity: { type: 'sort-sequence', data: { title: 'Ordena los pasos para lavarte los dientes', items: ['Poner crema dental', 'Mojar el cepillo', 'Enjuagar la boca', 'Cepillar los dientes'], correctOrder: ['Mojar el cepillo', 'Poner crema dental', 'Cepillar los dientes', 'Enjuagar la boca'] }}}
                ]},
                { week: 5, title: "Semana 5: Creando Secuencias", lessons: [
                     { id: 'crea_secuencia', title: 'Crea una Secuencia', icon: 'üß±', content: `<p>Ahora te toca a ti. Piensa en los pasos para hacer algo simple, como prepararte un cereal con leche.</p>`, activity: { type: 'sort-sequence', data: { title: 'Ordena los pasos para preparar cereal', items: ['Poner leche', 'Comer', 'Poner cereal en el plato'], correctOrder: ['Poner cereal en el plato', 'Poner leche', 'Comer']}}}
                ]},
                { week: 6, title: "Semana 6: Programaci√≥n con Bloques", lessons: [ 
                    { id: 'prog_bloques', title: 'Programar con Bloques', icon: 'üß±', content: `<h3>¬°Como armar un rompecabezas!</h3><p>Programar es darle instrucciones a una computadora. Usamos bloques de colores con dibujos para que sea m√°s f√°cil.</p><div style="display:flex; justify-content:space-around; font-weight:bold; margin-top:10px;"><span style="background:#3b82f6; color:white; padding:10px; border-radius:5px;">AVANZAR ‚û°Ô∏è</span><span style="background:#f59e0b; color:white; padding:10px; border-radius:5px;">GIRAR ‚Ü™Ô∏è</span><span style="background:#22c55e; color:white; padding:10px; border-radius:5px;">SALTAR ‚è´</span></div>`} 
                ]},
                { week: 7, title: "Semana 7: ¬øQu√© es un Algoritmo?", lessons: [ 
                    { id: 'algoritmo', title: 'Una Receta para el Robot', icon: 'üìñ', content: `<p>Un algoritmo es como una receta de cocina. Es una lista de pasos ordenados que, si los sigues, siempre te dan el mismo resultado. ¬°Las computadoras y los robots necesitan algoritmos para funcionar!</p>`}
                ]},
                { week: 8, title: "Semana 8: Encontrando Errores", lessons: [ 
                    { id: 'debugging', title: '¬°Encuentra el Error!', icon: 'üîé', content: `<p>A veces, las instrucciones tienen errores y las cosas no salen bien. ¬°Encontrar y arreglar esos errores se llama "depurar"!</p>`, activity: { type: 'sort-sequence', data: { title: 'Esta secuencia para hacer un dibujo tiene un error. ¬°Ord√©nala bien!', items: ['Dibujar', 'Tomar un l√°piz', 'Tomar una hoja'], correctOrder: ['Tomar una hoja', 'Tomar un l√°piz', 'Dibujar'] }}}
                ]},
                { week: 9, title: "Semana 9: Creatividad Digital", lessons: [ 
                    { id: 'dibujo_digital', title: 'Dibujando en la App', icon: 'üß±', content: `<p>Podemos usar la tecnolog√≠a para ser creativos y dibujar cosas incre√≠bles sin necesidad de papel y l√°piz.</p>`, activity: {type: 'draw', data: { title: 'Dibuja tu artefacto tecnol√≥gico favorito'}}}
                ]},
                { week: 10, title: "Semana 10: Mi Primer Dise√±o", lessons: [
                    { id: 'diseno_robot', title: 'Dise√±a tu Propio Robot', icon: 'üß±', content: `<p>¬°Usa tu imaginaci√≥n! Piensa en un robot que pueda ayudarte a hacer algo en casa. ¬øC√≥mo ser√≠a? ¬øQu√© partes tendr√≠a?</p>`, activity: {type: 'draw', data: { title: 'Usa formas simples (c√≠rculos, cuadrados) para dise√±ar un robot'}}}
                ]},
                { week: 11, title: "Semana 11: Presento mi Proyecto", lessons: [
                    { id: 'presentacion', title: '¬°Muestra tu Talento!', icon: 'üìñ', content: `<h3>¬°Felicidades, Roboaventurero!</h3><p>Has aprendido much√≠simo sobre tecnolog√≠a y programaci√≥n. Es hora de mostrar tus creaciones. ¬°Cu√©ntale a tu familia o amigos sobre los robots que dise√±aste y las actividades que completaste!</p>`}
                ]}
            ];

            const weeksContainer = document.getElementById('weeks-container');

            function populateStudyZone() {
                weeksContainer.innerHTML = '';
                studyWeeks.forEach(weekData => {
                    const weekEl = document.createElement('div');
                    weekEl.className = 'week-card';
                    
                    let lessonsHtml = '';
                    if (weekData.lessons && weekData.lessons.length > 0) {
                        weekData.lessons.forEach(lesson => {
                            lessonsHtml += `<button class="btn lesson-btn" onclick="showLesson('${lesson.id}')"><span>${lesson.icon}</span> ${lesson.title}</button>`;
                        });
                    }

                    weekEl.innerHTML = `<h2>${weekData.title}</h2><div class="lessons-grid">${lessonsHtml}</div>`;
                    weeksContainer.appendChild(weekEl);
                });
            }

            window.showLesson = function(lessonId) {
                let lesson;
                for (const week of studyWeeks) {
                    const found = week.lessons.find(l => l.id === lessonId);
                    if (found) { lesson = found; break; }
                }

                if (lesson) {
                    document.getElementById('lesson-title').innerText = lesson.title;
                    document.getElementById('lesson-content').innerHTML = lesson.content;
                    renderActivity(lesson);
                    document.getElementById('lesson-modal').style.display = 'flex';
                }
            }
            
            function renderActivity(lesson) {
                const activityContainer = document.getElementById('activity-container');
                activityContainer.innerHTML = '';
                if (!lesson.activity) return;

                const { type, data } = lesson.activity;
                activityContainer.innerHTML = `<h4>¬°Actividad Pr√°ctica!</h4><h5>${data.title}</h5>`;
                
                if (type === 'sort') {
                    activityContainer.innerHTML += `
                        <div class="sort-activity">
                            <div class="sort-items"><h4>Arrastra desde aqu√≠:</h4>${data.items.map(item => `<div class="draggable-item" draggable="true" data-type="${item.type.toLowerCase()}">${item.name}</div>`).join('')}</div>
                            <div class="drop-zones">${data.zones.map(zone => `<div><h4>${zone}</h4><div class="drop-zone" data-zone="${zone.toLowerCase()}"></div></div>`).join('')}</div>
                        </div>
                        <button class="btn btn-purple check-btn">Revisar</button>
                        <p class="feedback-message"></p>
                    `;
                    activityContainer.querySelector('.check-btn').onclick = () => checkSortAnswers(activityContainer, data.zones);
                } else if (type === 'sort-sequence') {
                     activityContainer.innerHTML += `
                        <div class="drop-zone sequence-container">${data.items.map(item => `<div class="draggable-item" draggable="true">${item}</div>`).join('')}</div>
                        <button class="btn btn-purple check-btn">Revisar</button>
                        <p class="feedback-message"></p>
                    `;
                    activityContainer.querySelector('.check-btn').onclick = () => checkSequence(activityContainer, data.correctOrder);
                } else if (type === 'draw') {
                    activityContainer.innerHTML += `
                        <canvas class="drawing-canvas" width="400" height="300"></canvas>
                        <div class="canvas-controls">
                            <button class="btn btn-red clear-canvas-btn">Limpiar</button>
                        </div>
                    `;
                    setupDrawingCanvas(activityContainer.querySelector('.drawing-canvas'));
                }
                
                addDragAndDropListeners(activityContainer);
            }

            function setupDrawingCanvas(canvas) {
                const ctx = canvas.getContext('2d');
                let drawing = false;

                const getPos = (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    return { x: clientX - rect.left, y: clientY - rect.top };
                };

                const startDrawing = (e) => {
                    drawing = true;
                    draw(e);
                };
                const stopDrawing = () => {
                    drawing = false;
                    ctx.beginPath();
                };
                const draw = (e) => {
                    if (!drawing) return;
                    e.preventDefault();
                    const { x, y } = getPos(e);
                    ctx.lineWidth = 5;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = '#333';
                    ctx.lineTo(x, y);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                };

                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('touchstart', startDrawing);
                canvas.addEventListener('touchend', stopDrawing);
                canvas.addEventListener('touchmove', draw);
                
                const parent = canvas.parentElement;
                parent.querySelector('.clear-canvas-btn').addEventListener('click', () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                });
            }

            function addDragAndDropListeners(container) {
                let draggingElement = null;
                container.querySelectorAll('.draggable-item').forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        draggingElement = item;
                        e.dataTransfer.setData('text/plain', item.innerText);
                    });
                     item.addEventListener('dragend', () => { draggingElement = null; });
                });
                container.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.addEventListener('dragover', e => e.preventDefault());
                    zone.addEventListener('drop', e => {
                        e.preventDefault();
                        if(draggingElement) zone.appendChild(draggingElement);
                    });
                });
                
                const sequenceContainer = container.querySelector('.sequence-container');
                if (sequenceContainer) {
                    sequenceContainer.addEventListener('dragover', e => {
                        e.preventDefault();
                        const afterElement = getDragAfterElement(sequenceContainer, e.clientY);
                        if (afterElement == null) {
                            sequenceContainer.appendChild(draggingElement);
                        } else {
                            sequenceContainer.insertBefore(draggingElement, afterElement);
                        }
                    });
                }
            }

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.draggable-item:not(.dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            function checkSortAnswers(container, zones) {
                let allCorrect = true;
                zones.forEach(zoneName => {
                    const zoneEl = container.querySelector(`.drop-zone[data-zone="${zoneName.toLowerCase()}"]`);
                    zoneEl.querySelectorAll('.draggable-item').forEach(item => {
                        if (item.dataset.type !== zoneName.toLowerCase()) {
                            item.style.backgroundColor = '#fecaca'; // Red
                            allCorrect = false;
                        } else {
                            item.style.backgroundColor = '#dcfce7'; // Green
                        }
                    });
                });
                const feedback = container.querySelector('.feedback-message');
                feedback.textContent = allCorrect ? '¬°Excelente! Todo est√° en su lugar.' : 'Algunos no est√°n bien. ¬°Int√©ntalo de nuevo!';
                feedback.style.color = allCorrect ? 'green' : 'red';
            }

            function checkSequence(container, correctOrder) {
                const userOrder = Array.from(container.querySelectorAll('.draggable-item')).map(el => el.innerText);
                const isCorrect = JSON.stringify(userOrder) === JSON.stringify(correctOrder);
                const feedback = container.querySelector('.feedback-message');
                feedback.textContent = isCorrect ? '¬°Perfecto! Ese es el orden correcto.' : 'El orden no es el correcto. ¬°Piensa en los pasos!';
                feedback.style.color = isCorrect ? 'green' : 'red';
            }
            
            populateStudyZone();


            // --- ZONA EVALUATIVA: L√ìGICA ---
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyBzHqBV7QQ1H2Hs7cAjfhSFzBOPf1iMh86L2bnNSJ2Oz2KCVieq6NqG6bKDAA9yxgB/exec';

            const evalQuestions = [
                { 
                    question: "¬øCu√°l de estos artefactos sirve para ver en la oscuridad?", 
                    options: [
                        { text: "L√°mpara", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#facc15"><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19c-3.86 0-7 3.14-7 7 0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/></svg>' }, 
                        { text: "Radio", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#fca5a5"><path d="M3 11c0-3.93 3.07-7 7-7h4c3.93 0 7 3.07 7 7v2c0 3.93-3.07 7-7 7h-4c-3.93 0-7-3.07-7-7v-2zm2 0v2c0 2.86 2.14 5 5 5h4c2.86 0 5-2.14 5-5v-2c0-2.86-2.14-5-5-5h-4c-2.86 0-5 2.14-5 5zm5-1h4c.55 0 1 .45 1 1s-.45 1-1 1h-4c-.55 0-1-.45-1-1s.45-1 1-1zm-2 4h8c.55 0 1 .45 1 1s-.45 1-1 1H8c-.55 0-1-.45-1-1s.45-1 1-1z"/></svg>' }, 
                        { text: "Silla", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#a7f3d0"><path d="M20.25 9.75H3.75c-.41 0-.75.34-.75.75v10.5c0 .41.34.75.75.75h1.5v1.5c0 .41.34.75.75.75s.75-.34.75-.75v-1.5h10.5v1.5c0 .41.34.75.75.75s.75-.34.75-.75v-1.5h1.5c.41 0 .75-.34.75-.75V10.5c0-.41-.34-.75-.75-.75zm-15 9V12h13.5v6.75H5.25zM20 3H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1z"/></svg>' }, 
                        { text: "Vaso", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#a5b4fc"><path d="M4.5 2h15c.83 0 1.5.67 1.5 1.5v17c0 .83-.67 1.5-1.5 1.5h-15C3.67 22 3 21.33 3 20.5V3.5C3 2.67 3.67 2 4.5 2zm1 2v16h13V4h-13z"/></svg>' }
                    ], 
                    answer: "L√°mpara" 
                },
                { 
                    question: "¬øQu√© objeto tecnol√≥gico usamos para hablar con alguien que est√° lejos?", 
                    options: [
                        { text: "Cama", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#c4b5fd"><path d="M21 10.78V8c0-1.1-.9-2-2-2h-5c-1.1 0-2 .9-2 2v2.78c-1.14.55-2 1.58-2 2.84V16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-2.38c0-1.26-.86-2.29-2-2.84zM19 8h-5V6h5v2zm-7 8v-2.38c0-.82.68-1.5 1.5-1.5h5c.82 0 1.5.68 1.5 1.5V16H12z"/></svg>' }, 
                        { text: "Tel√©fono", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#60a5fa"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24c1.12.37 2.33.57 3.57.57c.55 0 1 .45 1 1V20c0 .55-.45 1-1 1c-9.39 0-17-7.61-17-17c0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1c0 1.25.2 2.45.57 3.57c.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>' }, 
                        { text: "Plato", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#fdba74"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>' }, 
                        { text: "Libro", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#86efac"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg>' }
                    ], 
                    answer: "Tel√©fono" 
                },
                { 
                    question: "Si quieres ver tus dibujos animados, ¬øqu√© usas?", 
                    options: [
                        { text: "Estufa", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#9ca3af"><path d="M10 14H8v-2h2v2zm4 0h-2v-2h2v2zm-4-3H8V9h2v2zm4 0h-2V9h2v2zM20 6H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg>' }, 
                        { text: "Nevera", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#e5e7eb"><path d="M8 2h8c1.1 0 2 .9 2 2v16c0 1.1-.9 2-2 2H8c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2zm0 2v5h8V4H8zm0 7v9h8v-9H8zm1-5h2v2H9V6zm0 4h2v2H9v-2z"/></svg>' }, 
                        { text: "Televisor", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#3b82f6"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg>' }, 
                        { text: "Lavadora", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#d1d5db"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v2h-2v-2zm0 4h2v6h-2v-6z"/></svg>' }
                    ], 
                    answer: "Televisor" 
                },
                { 
                    question: "¬øCu√°l de estos es un objeto NATURAL y no tecnol√≥gico?", 
                    options: [
                        { text: "Carro", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ef4444"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/></svg>' },
                        { text: "Computadora", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#38bdf8"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg>' },
                        { text: "√Årbol", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#22c55e"><path d="M12 2C9.24 2 7 4.24 7 7c0 2.22 1.42 4.12 3.42 4.77-.38.25-.72.58-1.01.99C7.65 13.56 6.5 15.63 6.5 18H10v4h4v-4h3.5c0-2.37-1.15-4.44-2.91-5.24-.29-.41-.63-.74-1.01-.99C15.58 11.12 17 9.22 17 7c0-2.76-2.24-5-5-5z"/></svg>' },
                        { text: "Casa", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f59e0b"><path d="M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/></svg>' }
                    ],
                    answer: "√Årbol"
                },
                {
                    question: "Las sillas y las mesas de un sal√≥n, ¬øde qu√© est√°n hechas normalmente?",
                    options: [
                        { text: "Metal", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#9ca3af"><path d="M12 2c-5.52 0-10 4.48-10 10s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.8 13.8L11 11V5h2v5l4 4-1.2 1.8z"/></svg>' },
                        { text: "Vidrio", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#67e8f9"><path d="M4 2h16c1.1 0 2 .9 2 2v16c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2zm0 2v16h16V4H4z"/></svg>' },
                        { text: "Madera", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#a16207"><path d="M3 21h18v-2H3v2zm2-4h14v-2H5v2zm-2-4h18v-2H3v2zm2-4h14V7H5v2zm-2-4h18V3H3v2z"/></svg>' },
                        { text: "Tela", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f472b6"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>' }
                    ],
                    answer: "Madera"
                },
                {
                    question: "Para ponerte los zapatos, ¬øqu√© haces PRIMERO?",
                    options: [
                        { text: "Amarrar cordones", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#4ade80"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>' },
                        { text: "Ponerse el zapato", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#e879f9"><path d="M20.5 12c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 4.08 3.05 7.44 7 7.93V22h2v-2.07c3.95-.49 7-3.85 7-7.93zm-8 6c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/></svg>' },
                        { text: "Ponerse el calcet√≠n", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#fbbf24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>' },
                        { text: "Salir a jugar", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#38bdf8"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>' }
                    ],
                    answer: "Ponerse el calcet√≠n"
                },
                {
                    question: "Si un robot necesita ir hacia adelante, ¬øqu√© bloque usar√≠as?",
                    options: [
                        { text: "Saltar ‚è´", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#22c55e"><path d="m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg>' },
                        { text: "Girar ‚Ü™Ô∏è", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f59e0b"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>' },
                        { text: "Avanzar ‚û°Ô∏è", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#3b82f6"><path d="m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/></svg>' },
                        { text: "Dormir üí§", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#a855f7"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2-9.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5zm4 0c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5z"/></svg>' }
                    ],
                    answer: "Avanzar ‚û°Ô∏è"
                },
                {
                    question: "Un algoritmo es como una...",
                    options: [
                        { text: "Adivinanza", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f43f5e"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>' },
                        { text: "Canci√≥n", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#34d399"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>' },
                        { text: "Receta de cocina", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#fb923c"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 4h6v2H9V4zm6 16H9v-2h6v2zm-3-4H9v-2h3v2zm0-4H9v-2h3v2zm0-4H9V8h3v2z"/></svg>' },
                        { text: "Pelota", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#0ea5e9"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>' }
                    ],
                    answer: "Receta de cocina"
                },
                {
                    question: "¬øCu√°l de estos artefactos sirve para TRANSPORTARNOS?",
                    options: [
                        { text: "Bicicleta", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#0891b2"><path d="M15.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-7 0c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm7.56 4.5H8.44l-3.32 9h2.24l2.12-6.09 3.01 3.59-1.05 3.5H14.5l3.08-9.25-2.42-2.75z"/></svg>' },
                        { text: "Cuchara", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#a1a1aa"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>' },
                        { text: "Libro", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#86efac"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg>' },
                        { text: "Cama", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#c4b5fd"><path d="M21 10.78V8c0-1.1-.9-2-2-2h-5c-1.1 0-2 .9-2 2v2.78c-1.14.55-2 1.58-2 2.84V16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-2.38c0-1.26-.86-2.29-2-2.84zM19 8h-5V6h5v2zm-7 8v-2.38c0-.82.68-1.5 1.5-1.5h5c.82 0 1.5.68 1.5 1.5V16H12z"/></svg>' }
                    ],
                    answer: "Bicicleta"
                },
                {
                    question: "Si tu robot choca contra una pared, ¬øqu√© significa?",
                    options: [
                        { text: "Est√° jugando", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#34d399"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>' },
                        { text: "La pared es suave", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#a7f3d0"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>' },
                        { text: "Error en la instrucci√≥n", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f87171"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>' },
                        { text: "Tiene hambre", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#facc15"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>' }
                    ],
                    answer: "Error en la instrucci√≥n"
                }
            ];

            let currentQuestionIndex = 0;
            let studentAnswers = [];
            let studentName = '';
            let studentCourse = '';

            const questionTextEl = document.getElementById('question-text');
            const optionsContainerEl = document.getElementById('options-container');
            const nextQuestionBtn = document.getElementById('next-question-btn');
            
            document.getElementById('start-eval-btn').addEventListener('click', () => {
                studentName = document.getElementById('student-name').value;
                studentCourse = document.getElementById('student-course').value;

                if (studentName.trim() === '' || studentCourse.trim() === '') {
                    alert('Por favor, ingresa tu nombre y curso para continuar.');
                    return;
                }
                
                const studentId = `${studentName.trim().toLowerCase()}-${studentCourse.trim().toLowerCase()}`;
                if (localStorage.getItem(studentId)) {
                    alert('Ya has presentado esta evaluaci√≥n. No puedes repetirla.');
                    return;
                }

                currentQuestionIndex = 0;
                studentAnswers = [];
                showView('quiz-view');
                displayQuestion();
            });

             function speakText(text) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }

            function displayQuestion() {
                const question = evalQuestions[currentQuestionIndex];
                questionTextEl.innerText = question.question;
                
                const audioBtn = document.getElementById('play-question-audio');
                audioBtn.onclick = () => speakText(question.question);

                optionsContainerEl.innerHTML = '';
                
                question.options.forEach(optionData => {
                    const optionEl = document.createElement('div');
                    optionEl.className = 'option';
                    optionEl.innerHTML = `
                        ${optionData.svg}
                        <span>${optionData.text}</span>
                    `;
                    optionEl.addEventListener('click', () => selectOption(optionEl, optionData.text));
                    optionsContainerEl.appendChild(optionEl);
                });
                nextQuestionBtn.style.display = 'none';
            }
            
            function selectOption(optionEl, optionText) {
                const allOptions = optionsContainerEl.querySelectorAll('.option');
                allOptions.forEach(opt => opt.classList.remove('selected'));
                optionEl.classList.add('selected');
                
                studentAnswers[currentQuestionIndex] = optionText;
                nextQuestionBtn.style.display = 'block';
            }

            nextQuestionBtn.addEventListener('click', () => {
                currentQuestionIndex++;
                if (currentQuestionIndex < evalQuestions.length) {
                    displayQuestion();
                } else {
                    finishEvaluation();
                }
            });

            function finishEvaluation() {
                window.speechSynthesis.cancel();
                let score = 0;
                for(let i=0; i<evalQuestions.length; i++) {
                    if (studentAnswers[i] === evalQuestions[i].answer) {
                        score++;
                    }
                }
                
                const finalScoreText = `${score} / ${evalQuestions.length}`;
                document.getElementById('final-score').innerText = finalScoreText;
                document.getElementById('results-message').innerText = score > (evalQuestions.length / 2) ? "¬°Excelente trabajo, eres una superestrella!" : "¬°Buen intento, sigue practicando!";
                showView('results-view');

                const data = {
                    name: studentName,
                    course: studentCourse,
                    answers: JSON.stringify(studentAnswers),
                    finalScore: finalScoreText
                };
                
                const studentId = `${studentName.trim().toLowerCase()}-${studentCourse.trim().toLowerCase()}`;
                localStorage.setItem(studentId, 'completed');
                
                console.log("Simulaci√≥n: Los siguientes datos se enviar√≠an a Google Sheets:", data);
            }
        });
    </script>
</body>
</html>




